#! /bin/bash

if [ $# -ne 2 ]
then
  if [ -f experiment.wrf4g ]; then
     sed -e 's/\ *=\ */=/' experiment.wrf4g > source.it        || exit ${ERROR_MISSING_WRFINPUT}
     source source.it && rm source.it
  fi
fi

if test ${#} -ge 1; then
  while test "$*"; do
    case $1 in   
      -e)
          experiment_name=$2
          shift
        ;;      
      -r)
      	  realization_name=$2
          only_rea="yes"
          shift
        ;;
      --help)
         echo "Usage: `basename $0` [-e experiment_name -f realization_name]"
         echo
         echo "If experiment.wrf4g is present, the experiment configured in this file will be launched, otherwise provide the experiment name with the flag -e or the realization name with -r"
      ;;
      *)
        echo "Unknown argument: $1"
        exit
        ;;
    esac
    shift
  done
fi





if test -z $WRF4G_LOCATION; then
   echo '$WRF4G_LOCATION variable not established. Please export WRF4G_LOCATION and try again'
   exit 1
fi

userdir=`pwd`

#
#  Prepare environment
#
export PATH=${WRF4G_LOCATION}/bin:${PATH}
export PYTHONPATH=${PYTHONPATH}:${WRF4G_LOCATION}/lib/python

#
#  Load configuration files
#
grep "DB_.*=" ${WRF4G_LOCATION}/etc/framework4g.conf | sed -e 's/\ *=\ */=/' > db4g.conf
export DB4G_CONF=`pwd`/db4g.conf ; source $DB4G_CONF

if [ -n "$experiment_name" ]; then
  WRF4G.py Experiment ps name=${experiment_name}
else 
  WRF4G.py Realization ps name=${realization_name}
fi

rm db4g.conf

